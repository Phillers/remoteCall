/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "remoteCall.h"
#include "callBack.h"
#include <unistd.h>
CLIENT *clnt;


int global_res;
int global_exit=0;
int global_pid;

void finish(int sig){
    void * result_2 = senddata_1("", 0, clnt);
    if (result_2 == (void *) NULL) {
        clnt_perror(clnt, "call failed");
    }
    clnt_destroy(clnt);
    exit(0);
}

void remotecall_1(char *host, char *command) {

    void *result_2;
    char senddata_1_data[1025];
    int senddata_1_size = 0;
    void *result_1;
    char *callcommand_1_command = command;

#ifndef    DEBUG
    clnt = clnt_create(host, remoteCall, v1, "udp");
    if (clnt == NULL) {
        clnt_pcreateerror(host);
        exit(1);
    }
#endif	/* DEBUG */
    global_pid = fork();
    if (global_pid == 0) {
        result_1 = callcommand_1(callcommand_1_command, clnt);
        if (result_1 == (void *) NULL) {
            clnt_perror(clnt, "call failed");
        }


        memset(senddata_1_data, 0, 1025);
        signal(10, finish);
        while ((senddata_1_size = read(0, senddata_1_data, 1024)) > 0) {
            result_2 = senddata_1(senddata_1_data, senddata_1_size, clnt);
            if (result_2 == (void *) NULL) {
                clnt_perror(clnt, "call failed");
            }
            memset(senddata_1_data, 0, 1025);
        }
        result_2 = senddata_1(senddata_1_data, senddata_1_size, clnt);
        if (result_2 == (void *) NULL) {
            clnt_perror(clnt, "call failed");
        }
    }


#ifndef    DEBUG
    clnt_destroy(clnt);
#endif	 /* DEBUG */
    if (global_pid == 0)exit(0);
}


int main(int argc, char *argv[]) {
    char *host;

    if (argc < 3) {
        printf("usage: %s server_host commanc\n", argv[0]);
        exit(1);
    }
    host = argv[1];
    remotecall_1(host, argv[2]);
    main2(argc, argv);
    exit(0);
}
